
/* Mobile + small tablet overrides focused on touchability and stacking */
@media (max-width: 900px) {
  :root {
    --text-xs: 12px;
    --text-sm: 14px;
    --text-base: 16px;
  }

  /* Layout: force single-column master/detail with compact header/footer */
  .app-shell {
    grid-template-rows: auto 1fr auto;
  }

  .app-body {
    padding: 12px;
    overflow-x: hidden;
  }

  .panel.two-column {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .column--list {
    order: 1;
  }

  .column--detail {
    order: 2;
  }

  /* Constrain list height so detail stays visible */
  .column--list .list {
    max-height: 42vh;
    min-height: 180px;
  }

  /* Header: wrap quick actions and keep readable spacing */
  .app-header {
    padding: 10px 14px;
    gap: 8px;
    flex-wrap: wrap;
  }

  .header-right {
    flex-wrap: wrap;
    gap: 8px;
    width: 100%;
    justify-content: flex-start;
  }

  /* Touch targets */
  button,
  .btn,
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
    padding: 9px 14px;
    font-size: 14px;
  }

  /* Badges stay legible but not oversized */
  .badge {
    font-size: 11px;
    padding: 4px 8px;
    min-height: 20px;
  }

  /* Sequence + controls stack vertically with breathing room */
  .detail-viewers {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  .sequence-view {
    min-height: 280px;
  }

  .sequence-view .toolbar button {
    padding: 8px 12px;
    margin: 2px;
  }

  /* 3D view stays visible but not full-height */
  .three-container {
    width: 100%;
    min-height: 240px;
    height: min(360px, 60vh);
  }

  /* Footer keyboard hints are noise on mobile */
  .app-footer .footer-hints {
    display: none;
  }

  /* Prevent horizontal scrollbars from nested panels */
  .panel {
    overflow-x: hidden;
  }
}

/* Phone-only drawer behavior */
@media (max-width: 640px) {
  .column--list.mobile-drawer {
    position: fixed;
    inset: 0;
    z-index: var(--z-modal);
    background: var(--color-background);
    padding: 12px;
    padding-top: calc(12px + env(safe-area-inset-top));
    padding-bottom: calc(12px + env(safe-area-inset-bottom));
    overflow: hidden;
  }

  .column--list.mobile-drawer .list {
    max-height: none;
    min-height: 0;
  }
}

/* Ultra-small devices */
@media (max-width: 540px) {
  .app-header {
    padding: 8px 10px;
  }

  .panel.two-column {
    gap: 8px;
  }

  .column--list .list {
    max-height: 38vh;
  }
}

/* =============================================================================
   WCAG 2.5.5 Touch Target Compliance (44x44px minimum)
   Applies to touch devices (phones, tablets) for accessibility
   ============================================================================= */
@media (hover: none) and (pointer: coarse) {
  /* Base button touch targets */
  button,
  .btn,
  [role="button"],
  [role="tab"],
  [role="menuitem"],
  [role="option"],
  a[href] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Icon buttons - expand hit area without changing visual size */
  .btn-icon,
  .btn.icon-only,
  button[aria-label]:not(.btn-lg) {
    min-height: 44px;
    min-width: 44px;
    padding: 10px;
  }

  /* Small buttons - keep visual appearance but expand hit area */
  .btn-sm {
    min-height: 44px;
    min-width: 44px;
    padding: 8px 14px;
  }

  /* Compact toolbar buttons - expand hit area for touch */
  .btn.compact,
  .toolbar .btn,
  .segmented-control button {
    min-height: 44px;
    min-width: 44px;
    padding: 8px;
  }

  /* List items as touch targets */
  .list-item {
    min-height: 56px;
    padding: 12px 16px;
  }

  /* Badge buttons (when clickable) */
  .badge[role="button"],
  .badge.clickable,
  button.badge {
    min-height: 44px;
    min-width: 44px;
    padding: 10px 14px;
  }

  /* Overlay close buttons */
  .overlay-close,
  .modal-close,
  [aria-label="Close"],
  [aria-label="close"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Checkbox and radio targets - use transform for visual scaling without breaking layout */
  input[type="checkbox"],
  input[type="radio"] {
    width: 24px;
    height: 24px;
    /* Expand touch target without changing visual size */
    position: relative;
  }

  /* Invisible touch area expansion via pseudo-element */
  input[type="checkbox"]::after,
  input[type="radio"]::after {
    content: '';
    position: absolute;
    inset: -10px;
    /* Ensure it captures touch events */
    z-index: 1;
  }

  /* Labels wrapping checkboxes need adequate height */
  label:has(input[type="checkbox"]),
  label:has(input[type="radio"]) {
    min-height: 44px;
    display: flex;
    align-items: center;
    gap: var(--space-2, 8px);
  }

  /* Select dropdowns */
  select {
    min-height: 44px;
    padding: 10px 12px;
  }

  /* Text inputs - comfortable touch height */
  input[type="text"],
  input[type="search"],
  input[type="number"],
  input[type="email"],
  input[type="url"],
  textarea {
    min-height: 44px;
    padding: 10px 12px;
  }

  /* Tab buttons */
  [role="tab"] {
    min-height: 44px;
    padding: 10px 16px;
  }

  /* View mode segments */
  .view-mode-segment {
    min-height: 44px;
    padding: 10px 14px;
  }

  /* Ensure adequate spacing between adjacent touch targets */
  .badge-row {
    gap: 8px;
  }

  .toolbar {
    gap: 8px;
  }

  .btn + .btn,
  button + button {
    margin-left: 4px;
  }
}

/* =============================================================================
   MOBILE-ONLY UTILITY
   Elements that should only be visible on mobile devices
   ============================================================================= */

.mobile-only {
  display: none;
}

@media (max-width: 768px) {
  .mobile-only {
    display: flex;
    align-items: center;
  }
}

/* =============================================================================
   PHAGE LIST MOBILE FIXES
   ============================================================================= */
@media (max-width: 640px) {
  /* List items need larger touch targets */
  .phage-list [role="option"] {
    min-height: 48px;
    padding: 12px 12px !important;
  }

  /* Hide keyboard navigation hint on mobile - useless for touch */
  .phage-list kbd {
    display: none;
  }

  /* Hide the entire keyboard hint row on mobile */
  .phage-list > div:last-child:has(kbd) {
    display: none;
  }
}

/* =============================================================================
   COMMAND PALETTE MOBILE FIXES
   ============================================================================= */
@media (max-width: 640px) {
  /* Experience level buttons need larger touch targets */
  .overlay-commandPalette [role="group"] button[aria-pressed] {
    min-height: 44px;
    padding: 10px 14px;
  }

  /* Hide verbose description on mobile to save space */
  .overlay-commandPalette [role="group"] > span:last-child {
    display: none;
  }

  /* Command list items need proper touch targets */
  .overlay-commandPalette [role="listbox"] [role="option"] {
    min-height: 48px;
    padding: 12px;
  }
}

/* Data freshness indicator styling */
.data-freshness-indicator {
  position: fixed;
  bottom: calc(var(--space-2) + 60px);
  right: var(--space-2);
  z-index: 50;
  opacity: 0.8;
  transition: opacity var(--transition-fast);
}

.data-freshness-indicator:hover {
  opacity: 1;
}

/* On mobile, move indicator above FAB and control deck */
@media (max-width: 900px) {
  .data-freshness-indicator {
    bottom: calc(80px + env(safe-area-inset-bottom));
    right: calc(16px + env(safe-area-inset-right));
  }
}

/* On phones with control deck, position above it */
@media (max-width: 640px) {
  .data-freshness-indicator {
    bottom: calc(var(--control-deck-reserved-height, 140px) + 16px + env(safe-area-inset-bottom));
  }
}
